---
title: "Networking Avanzado KVM: Bridges & VLANs"
description: Dise√±o e implementaci√≥n de segmentaci√≥n de red 802.1Q y Linux Bridges persistentes sobre host de virtualizaci√≥n.
sidebar:
  label: Networking KVM (VLANs)
  order: 5
type: scenario
domain: networking
---

import { Steps, LinkButton } from '@astrojs/starlight/components';

## üìã Definici√≥n de Arquitectura

**Contexto de Ingenier√≠a:**
En entornos de virtualizaci√≥n *bare-metal* (Host KVM), el uso de una red plana ("Flat Network") presenta riesgos de seguridad y congesti√≥n de broadcast. Se requiere evolucionar la configuraci√≥n de red del host anfitri√≥n para soportar **m√∫ltiples zonas de aislamiento** utilizando una √∫nica interfaz f√≠sica (Trunk).

**Objetivos de Dise√±o:**
1.  **Desacoplamiento L3:** La IP de gesti√≥n del host no debe residir en la interfaz f√≠sica, sino en un Bridge virtual, permitiendo mayor flexibilidad.
2.  **Segmentaci√≥n 802.1Q:** Implementaci√≥n de sub-interfaces VLAN para segregar tr√°fico de Gesti√≥n (VLAN 19) y Laboratorio/Tenant (VLAN 88).
3.  **Persistencia NetworkManager:** Configuraci√≥n declarativa mediante `nmcli` para garantizar la estabilidad tras reinicios, abandonando scripts legacy.

---

## üèóÔ∏è Topolog√≠a L√≥gica del Host

El siguiente diagrama detalla la pila de red interna configurada dentro del Host KVM (`kvm-001`).

```mermaid
graph TD
    subgraph Physical_Layer [Capa F√≠sica]
        ENO1[("Interfaz F√≠sica<br/>(eno1 - Trunk)")]:::phys
    end

    subgraph VLAN_Layer [Capa 802.1Q - Tagging]
        VLAN19["eno1.19<br/>(VLAN ID: 19)"]:::vlan
        VLAN88["eno1.88<br/>(VLAN ID: 88)"]:::vlan
    end

    subgraph Bridge_Layer [Capa L2 - Switching Virtual]
        BR19["br19<br/>(Bridge Gesti√≥n)"]:::bridge
        BR88["br88<br/>(Bridge Cargas de Trabajo)"]:::bridge
    end

    subgraph IP_Layer [Capa L3 - Routing]
        IP_HOST["IP Host KVM<br/>192.168.19.50/24"]:::ip
        VM_MGMT["VM Controlador"]:::vm
        VM_LAB["VM Aplicaci√≥n"]:::vm
    end

    ENO1 ==> VLAN19
    ENO1 ==> VLAN88
    
    VLAN19 --> BR19
    VLAN88 --> BR88
    
    BR19 -.-> IP_HOST
    BR19 --> VM_MGMT
    BR88 --> VM_LAB

    %% Estilos Profesionales
    classDef phys fill:#e3f2fd,stroke:#1565c0,color:#0d47a1,stroke-width:2px;
    classDef vlan fill:#fff9c4,stroke:#fbc02d,color:#000;
    classDef bridge fill:#c8e6c9,stroke:#2e7d32,color:#1b5e20,stroke-width:2px;
    classDef ip fill:#ffccbc,stroke:#d84315,color:#bf360c;
    classDef vm fill:#f5f5f5,stroke:#616161,color:#000;
```

---

## üöÄ Procedimiento de Implementaci√≥n (SOP)

Este dise√±o ha sido estandarizado y documentado en la **Librer√≠a de Est√°ndares de Operaciones**. El SOP detalla los comandos at√≥micos de `nmcli` necesarios para transformar una interfaz est√°ndar en un trunk VLAN con bridges.

<div style="display: flex; justify-content: center; gap: 1rem; margin: 2rem 0;">
  <LinkButton 
    href="https://github.com/daniel-zamo/ops-standards-library/blob/main/linux/SOP-LINUX-NM-01_bridge-vlan-config.md"
    variant="primary"
    icon="github"
    target="_blank"
  >
    Ver Procedimiento T√©cnico (GitHub)
  </LinkButton>
  <LinkButton 
    href="https://github.com/daniel-zamo/ops-standards-library/tree/main/linux"
    variant="secondary"
    icon="external"
    target="_blank"
  >
    Explorar Repo OPS
  </LinkButton>
</div>

### Resultados de la Configuraci√≥n

Al aplicar esta arquitectura:

1.  **Aislamiento:** Las VMs conectadas a `br88` est√°n l√≥gicamente aisladas de la red de gesti√≥n del host.
2.  **Estandarizaci√≥n:** Se elimina la dependencia de nombres de interfaz impredecibles (ej. `eth0` vs `enp3s0`) al abstraer la conexi√≥n en Bridges estandarizados (`brXX`).
3.  **Observabilidad:** La estructura permite inspeccionar el tr√°fico de cada segmento independientemente usando `tcpdump -i br19`.
