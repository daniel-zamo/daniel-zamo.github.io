---
title: "Gesti칩n del Ciclo de Vida LVM"
description: Redimensionamiento din치mico de Grupos de Vol칰menes y retiro de Vol칰menes F칤sicos en producci칩n.
sidebar:
  label: Gesti칩n LVM
  order: 3
type: scenario
domain: storage
source: manual
---

import { Steps } from '@astrojs/starlight/components';
import LabEnvironment from '../../../../../components/LabEnvironment.astro';

<LabEnvironment />

## 游늶 Requisitos de Ingenier칤a

**Contexto de Negocio:**
Una iniciativa de consolidaci칩n de almacenamiento requiere retirar el disco f칤sico `/dev/vdh` del grupo de vol칰menes existente `vol1`. Este disco debe ser reutilizado para crear un nuevo grupo de almacenamiento aislado (`vol2`) para un proyecto espec칤fico.

**Objetivos T칠cnicos:**
1.  **Migraci칩n en Caliente:** Evacuar datos de `/dev/vdh` sin interrupci칩n del servicio usando capacidades de mirroring de LVM.
2.  **Cambio de Topolog칤a:** Remover `/dev/vdh` de `vol1` e inicializar un nuevo Volume Group `vol2`.
3.  **Aprovisionamiento:** Crear un Volumen L칩gico `p1` (50 MiB) dentro de `vol2`.
4.  **Filesystem:** Formatear el nuevo volumen con **ext4**.

:::caution[Integridad de Datos]
En producci칩n, ejecutar `pvmove` es una operaci칩n intensiva en I/O. Aseg칰rese de que no haya backups cr칤ticos ejecut치ndose simult치neamente.
:::

---

## 游댢 Procedimiento de Implementaci칩n

<Steps>

1.  **Analizar Topolog칤a de Almacenamiento**

    Confirme el esquema actual y verifique que `/dev/vdh` es parte de `vol1`.

    ```bash
    sudo pvs
    sudo vgs
    ```

2.  **Evacuaci칩n de Datos (pvmove)**

    Reubique los "physical extents" (PE) asignados desde el disco objetivo hacia otros discos libres dentro del mismo Grupo de Vol칰menes.

    ```bash
    # Verificar asignaci칩n
    sudo pvdisplay -m /dev/vdh

    # Migrar datos
    sudo pvmove /dev/vdh
    ```

3.  **Retirar Disco**

    Una vez el disco est칠 totalmente libre, remu칠valo del Grupo de Vol칰menes.

    ```bash
    sudo vgreduce vol1 /dev/vdh
    ```

4.  **Inicializar Nuevo Grupo de Almacenamiento**

    Cree el nuevo Volume Group `vol2` usando el volumen f칤sico reclamado.

    ```bash
    sudo vgcreate vol2 /dev/vdh
    ```

5.  **Aprovisionar Volumen L칩gico**

    Asigne la capacidad de almacenamiento solicitada.

    ```bash
    sudo lvcreate -n p1 -L 50M vol2
    ```

6.  **Aplicar Sistema de Archivos**

    Formatee el dispositivo de bloque.

    ```bash
    sudo mkfs.ext4 /dev/vol2/p1
    ```

7.  **Validaci칩n Final**

    Verifique la nueva estructura LVM y la firma del filesystem.

    ```bash
    sudo lvs -o lv_name,vg_name,lv_size,seg_pe_ranges
    lsblk -f /dev/vol2/p1
    ```

</Steps>

## 游댌 Diagn칩stico y Resoluci칩n

*   **"Physical volume is still in use":** El comando `vgreduce` fallar치 si salt칩 el Paso 2. **Debe** evacuar los datos primero.
*   **"Insufficient free extents":** Si `vol1` no tiene suficiente espacio libre en otros discos (ej. `/dev/vdb`) para contener los datos de `/dev/vdh`, la operaci칩n `pvmove` fallar치.
