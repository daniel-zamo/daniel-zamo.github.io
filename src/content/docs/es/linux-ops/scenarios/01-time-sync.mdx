---
title: "Estrategia NTP y Sincronizaci贸n"
description: Configuraci贸n de pol铆ticas systemd-timesyncd para consistencia transaccional en cl煤sters distribuidos.
sidebar:
  label: Estrategia NTP
  order: 1
type: scenario
domain: networking
source: manual
---

import { Steps } from '@astrojs/starlight/components';
import LabEnvironment from '../../../../../components/LabEnvironment.astro';

<LabEnvironment />

##  Requisitos de Ingenier铆a

**Contexto de Negocio:**
Los registros de auditor铆a indican una deriva (drift) en los relojes del sistema a trav茅s del cl煤ster, causando fallos en la conciliaci贸n de transacciones distribuidas. Se debe aplicar una pol铆tica estricta de NTP en el nodo controlador.

**Objetivos T茅cnicos:**
1.  **Upstreams Primarios:** Configurar `0.pool.ntp.org` y `1.pool.ntp.org` como fuentes autoritativas.
2.  **Failover:** Definir `ntp.ubuntu.com` y `0.debian.pool.ntp.org` como servidores de respaldo.
3.  **Ajuste de Rendimiento (Tuning):**
    *   Intervalo m谩ximo de sondeo (Poll): `1000s`.
    *   Intervalo de reintento de conexi贸n: `20s`.

:::caution[Restricci贸n de Servicio]
El entorno utiliza `systemd-timesyncd` como cliente SNTP ligero est谩ndar. No instale paquetes `chrony` o `ntp` legacy a menos que se requiera expl铆citamente, para evitar conflictos de servicio.
:::

---

##  Procedimiento de Implementaci贸n

<Steps>

1.  **Auditor铆a del Estado Actual**

    Verifique la versi贸n del sistema operativo y el estado activo del servicio de tiempo antes de aplicar cambios.

    ```bash
    # Verificar versi贸n de OS
    cat /etc/os-release | grep PRETTY_NAME

    # Verificar estado del servicio
    timedatectl timesync-status
    ```

2.  **Aplicar Pol铆tica de Configuraci贸n**

    Edite el archivo de configuraci贸n del demonio `/etc/systemd/timesyncd.conf`.

    ```bash
    sudo vim /etc/systemd/timesyncd.conf
    ```

    Modifique la secci贸n `[Time]` para coincidir estrictamente con los requisitos:

    ```ini title="/etc/systemd/timesyncd.conf" {2-5}
    [Time]
    NTP=0.pool.ntp.org 1.pool.ntp.org
    FallbackNTP=ntp.ubuntu.com 0.debian.pool.ntp.org
    PollIntervalMaxSec=1000
    ConnectionRetrySec=20
    ```

3.  **Reiniciar Servicio**

    Aplique la nueva pol铆tica reiniciando la unidad systemd.

    ```bash
    sudo systemctl restart systemd-timesyncd.service
    ```

4.  **Validar Implementaci贸n**

    Confirme que el servicio est谩 activo y sincronizando con el estrato (stratum) correcto.

    ```bash
    # Estado del servicio
    sudo systemctl status systemd-timesyncd.service

    # Validar m茅tricas (Poll interval)
    timedatectl timesync-status
    ```

    *Criterio de Validaci贸n:* La salida debe mostrar `Active: active (running)` y las m茅tricas de intervalo coincidiendo con la configuraci贸n.

</Steps>

##  Diagn贸stico y Resoluci贸n

Si la sincronizaci贸n falla (ej. "Packet not received"), inspeccione el journal del sistema:

```bash
sudo journalctl -u systemd-timesyncd --no-pager | tail -n 20
```

*Indicador de xito:* Busque logs que indiquen: *"Contacted time server ... (0.pool.ntp.org)"*.
