---
title: "Escenario 01: Migraci贸n LAMP a Azure IaaS"
description: Despliegue automatizado de un servidor web Linux (Apache/PHP/MySQL) en Azure usando CLI y Cloud-Init.
sidebar:
  label: 01 - Stack LAMP IaaS
  order: 1
type: scenario
domain: compute
---

import { Steps } from '@astrojs/starlight/components';

##  Definici贸n del Proyecto

**Contexto de Negocio:**
Como parte de una iniciativa de modernizaci贸n, se requiere migrar una carga de trabajo web legacy (Stack LAMP) a la nube p煤blica. El objetivo es reducir la sobrecarga operativa del hardware f铆sico manteniendo el control total sobre la configuraci贸n del sistema operativo.

**Requisitos T茅cnicos:**
1.  **Aislamiento de Recursos:** Implementaci贸n de un Grupo de Recursos dedicado para la gesti贸n del ciclo de vida.
2.  **Seguridad de Red:** Segmentaci贸n mediante VNET y filtrado de tr谩fico estricto (NSG) permitiendo 煤nicamente HTTP (80) y SSH (22).
3.  **Eficiencia de C贸mputo:** Aprovisionamiento de instancia `Standard_B1s` (Burstable) sobre Ubuntu 22.04 LTS.
4.  **Automatizaci贸n (Infrastructure as Code):** El aprovisionamiento debe ser desatendido, utilizando **Cloud-Init** para la configuraci贸n del stack de software en el primer arranque.

:::tip[Estrategia de Aprovisionamiento]
En entornos productivos, se evita la configuraci贸n manual post-despliegue. El uso de **Custom Data (Cloud-Init)** garantiza que la VM est茅 operativa y configurada desde el segundo cero, facilitando la escalabilidad horizontal.
:::

---

##  Procedimiento de Implementaci贸n (Azure CLI)

Ejecuci贸n mediante `az cli` para garantizar la reproducibilidad y auditabilidad del despliegue.

<Steps>

1.  **Definici贸n de Variables de Entorno**

    Estandarizaci贸n de nomenclaturas para recursos.

    ```bash
    RG_NAME="rg-lamp-migration-001"
    LOCATION="northeurope"
    VM_NAME="vm-web-legacy-01"
    VNET_NAME="vnet-prod-01"
    NSG_NAME="nsg-web-public"
    ```

2.  **Creaci贸n del Contenedor L贸gico**

    ```bash
    az group create --name $RG_NAME --location $LOCATION
    ```

3.  **Configuraci贸n de Bootstrapping (Cloud-Init)**

    Definici贸n del estado deseado del sistema operativo. Este manifiesto instala dependencias y genera archivos de prueba autom谩ticamente.

    ```yaml title="cloud-init-lamp.txt"
    #cloud-config
    package_upgrade: true
    packages:
      - apache2
      - php
      - libapache2-mod-php
      - mysql-server
      - php-mysql
    write_files:
      - content: |
          <?php phpinfo(); ?>
        path: /var/www/html/info.php
    runcmd:
      - systemctl restart apache2
      - systemctl enable apache2
    ```

4.  **Despliegue de Infraestructura**

    Comando at贸mico que aprovisiona red, seguridad, IP p煤blica y c贸mputo, inyectando la configuraci贸n de Cloud-Init.

    ```bash
    az vm create \
      --resource-group $RG_NAME \
      --name $VM_NAME \
      --image Ubuntu2204 \
      --admin-username azureuser \
      --generate-ssh-keys \
      --public-ip-sku Standard \
      --size Standard_B1s \
      --custom-data @cloud-init-lamp.txt \
      --nsg $NSG_NAME
    ```

5.  **Hardening de Red (NSG)**

    Configuraci贸n expl铆cita de reglas de entrada para permitir tr谩fico web.

    ```bash
    az network nsg rule create \
      --resource-group $RG_NAME \
      --nsg-name $NSG_NAME \
      --name Allow-HTTP \
      --protocol Tcp \
      --priority 100 \
      --destination-port-range 80 \
      --access Allow
    ```

6.  **Verificaci贸n de Servicio**

    Validaci贸n de la disponibilidad del endpoint p煤blico.

    ```bash
    IP_ADDRESS=$(az vm show -d -g $RG_NAME -n $VM_NAME --query publicIps -o tsv)
    echo "Endpoint disponible en: http://$IP_ADDRESS/info.php"
    ```

</Steps>

##  Decisi贸n de Dise帽o

### 驴Por qu茅 Cloud-Init para este escenario?
Para despliegues de **instancias 煤nicas** o **im谩genes base**, Cloud-Init es el est谩ndar de la industria "Cloud-Native". Elimina la necesidad de un servidor de configuraci贸n externo (como Ansible Tower) para el bootstrap inicial, reduciendo la complejidad y el tiempo de arranque (RTO).
