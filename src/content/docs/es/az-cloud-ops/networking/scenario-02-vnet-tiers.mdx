---
title: "Escenario 02: Segmentaci贸n de Red Multinivel (VNET)"
description: Dise帽o e implementaci贸n de una topolog铆a de red segura con subredes aisladas para FrontEnd y BackEnd utilizando Azure CLI.
sidebar:
  label: 02 - VNET Tiers Aislada
  order: 2
type: scenario
domain: networking
---

import { Steps, Aside } from '@astrojs/starlight/components';

##  Definici贸n del Proyecto

**Contexto de Negocio:**
Tras el 茅xito de la migraci贸n del stack LAMP, la organizaci贸n requiere una arquitectura de red m谩s robusta que cumpla con el principio de **Privilegio M铆nimo**. El objetivo es desplegar una red virtual (VNET) segmentada que impida que las bases de datos sean accesibles directamente desde Internet.

**Requisitos T茅cnicos:**
1.  **Espacio de Direccionamiento:** VNET con prefijo `10.0.0.0/16`.
2.  **Segmentaci贸n por Niveles:** 
    *   **Subred FrontEnd:** `10.0.1.0/24` para servidores web.
    *   **Subred BackEnd:** `10.0.2.0/24` para bases de datos (aislada).
3.  **Seguridad Granular:** Uso de **Network Security Groups (NSG)** para filtrar el tr谩fico entre capas.
4.  **Aislamiento de BackEnd:** La capa de base de datos solo debe aceptar tr谩fico entrante originado desde la capa de FrontEnd en el puerto 3306 (MySQL).

<Aside type="caution" title="Seguridad de Red">
En Azure, por defecto, todas las subredes dentro de una misma VNET pueden comunicarse. Es imperativo aplicar NSGs espec铆ficos para romper esta visibilidad y securizar los datos sensibles.
</Aside>

---

##  Procedimiento de Implementaci贸n (Azure CLI)

Configuraci贸n de la base de red para arquitecturas multinivel.

<Steps>

1.  **Inicializaci贸n de Variables de Red**

    ```bash
    RG_NAME="rg-networking-core"
    LOCATION="northeurope"
    VNET_NAME="vnet-prod-segmentation"
    NSG_FRONT_NAME="nsg-frontend-tier"
    NSG_BACK_NAME="nsg-backend-tier"
    ```

2.  **Despliegue de la Red Virtual y Subred FrontEnd**

    ```bash
    az network vnet create \
      --resource-group $RG_NAME \
      --name $VNET_NAME \
      --address-prefix 10.0.0.0/16 \
      --subnet-name snet-frontend \
      --subnet-prefix 10.0.1.0/24
    ```

3.  **Creaci贸n de la Subred BackEnd (Capa de Datos)**

    ```bash
    az network vnet subnet create \
      --resource-group $RG_NAME \
      --vnet-name $VNET_NAME \
      --name snet-backend \
      --address-prefix 10.0.2.0/24
    ```

4.  **Creaci贸n y Asociaci贸n de NSGs**

    Es fundamental separar el control de acceso por cada capa de la arquitectura.

    ```bash
    # Crear NSGs
    az network nsg create --resource-group $RG_NAME --name $NSG_FRONT_NAME
    az network nsg create --resource-group $RG_NAME --name $NSG_BACK_NAME

    # Asociar a las subredes
    az network vnet subnet update \
      --resource-group $RG_NAME \
      --vnet-name $VNET_NAME \
      --name snet-frontend \
      --network-security-group $NSG_FRONT_NAME

    az network vnet subnet update \
      --resource-group $RG_NAME \
      --vnet-name $VNET_NAME \
      --name snet-backend \
      --network-security-group $NSG_BACK_NAME
    ```

5.  **Regla de Seguridad: Aislamiento de Capa de Datos**

    Configuraci贸n de la regla de "Permiso Cruzado" (Inter-Tier traffic).

    ```bash
    az network nsg rule create \
      --resource-group $RG_NAME \
      --nsg-name $NSG_BACK_NAME \
      --name Allow-FrontEnd-To-SQL \
      --priority 100 \
      --source-address-prefixes 10.0.1.0/24 \
      --destination-port-ranges 3306 \
      --access Allow \
      --protocol Tcp \
      --description "Permite trafico SQL solo desde la subred FrontEnd."
    ```

</Steps>

##  Decisi贸n de Dise帽o

### 驴Por qu茅 segmentar mediante Subredes y NSGs?
Esta aproximaci贸n implementa la **Defensa en Profundidad**. Al separar los niveles de aplicaci贸n en diferentes subredes, reducimos el radio de impacto (*blast radius*) en caso de una intrusi贸n en el servidor web. Incluso si el nivel FrontEnd se ve comprometido, el atacante no tiene libre acceso a la capa de datos gracias a las reglas restrictivas del NSG del BackEnd.
