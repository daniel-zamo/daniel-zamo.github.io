---
title: "Estrategia de Backup WSL 2: Grandes Vol√∫menes (>2GB)"
description: "Resoluci√≥n de errores de exportaci√≥n de instancias pesadas y correcci√≥n de sintaxis para 7-Zip en PowerShell."
sidebar:
  label: "WSL 2: Backup High-Capacity"
  badge:
    text: "SOP"
    variant: caution
---

import { Steps, Aside, LinkCard, CardGrid, Badge } from '@astrojs/starlight/components';

Cuando las distribuciones de WSL exceden los **2GB**, el comando nativo de Windows `Compress-Archive` falla debido a limitaciones del est√°ndar Zip32. Para entornos de producci√≥n o distros con grandes vol√∫menes de datos, es imperativo utilizar herramientas externas como **7-Zip** o **Tar**.

<Aside type="danger" title="Error Com√∫n">
`System.IO.IOException: Stream was too long.`  
Si ves este error en PowerShell, est√°s intentando comprimir un archivo mayor a 2GB con herramientas nativas obsoletas.
</Aside>

---

## üîÑ Flujo de Empaquetado Robusto

Este diagrama describe la l√≥gica de decisi√≥n para elegir la herramienta de compresi√≥n seg√∫n el tama√±o del artefacto.

```mermaid
graph TD
    Start[Inicio] --> Shutdown[wsl --shutdown]
    Shutdown --> Export[wsl --export]
    Export --> Size{¬øTama√±o > 2GB?}
    Size -- S√≠ --> Tool[Usar 7-Zip / Tar.exe]
    Size -- No --> Native[Compress-Archive]
    Tool --> Syntax[Sintaxis: Separar con ESPACIOS]
    Syntax --> Final[ZIP64 generado exitosamente]
    Native --> Final
```

---

## üõ†Ô∏è Script de Ejecuci√≥n Corregido (PowerShell 7)

Al invocar binarios externos como `7z.exe`, PowerShell maneja los argumentos de forma distinta a los cmdlets nativos. **El error m√°s frecuente es separar las rutas con comas.**

<Steps>

1.  **Cierre de Instancias**
    Aseguramos la consistencia del VHDX antes del export.
    ```powershell
    wsl --shutdown
    ```

2.  **Definici√≥n de Variables**
    Configuramos las rutas de destino (Tier Caliente).
    ```powershell
    $dest = "D:\10_Hot-Tier_Caliente\WSL\backups"
    ```

3.  **Empaquetado con 7-Zip (Array Pattern)**
    La forma m√°s limpia de pasar archivos a 7-Zip es mediante un array. PowerShell lo expandir√° autom√°ticamente usando **espacios** como separador.

    ```powershell
    # Bundle para Ubuntu (~20GB)
    $ubuntuFiles = @(
        "$dest\Ubuntu.tar",
        "$env:APPDATA\alacritty\alacritty.toml",
        "$dest\README_Ubuntu.md"
    )

    # Invocaci√≥n directa (7z debe estar en el PATH)
    7z.exe a -tzip "$dest\WSL_Ubuntu_Migration.zip" $ubuntuFiles
    ```

</Steps>

---

## ‚ö†Ô∏è Troubleshooting de Sintaxis

| Error | Causa | Soluci√≥n |
| :--- | :--- | :--- |
| `Stream was too long` | L√≠mite de 2GB en `Compress-Archive`. | Cambiar a **7-Zip** o **Tar**. |
| `The filename... syntax is incorrect` | Uso de comas (`,`) en los argumentos de 7z. | Pasar los archivos separados por espacios o v√≠a Array. |
| `Scan WARNINGS` | Caracteres extra√±os o rutas no encontradas. | Verificar comillas en rutas que contienen espacios. |

---

## üîó Recursos y Notas Relacionadas

<CardGrid>
  <LinkCard 
    title="SOP Anterior: Export RootFS" 
    description="Requisitos previos para generar el archivo .tar base." 
    href="/es/notes/wsl-export-guide/" 
  />
  <LinkCard 
    title="Descargar 7-Zip" 
    description="Binario oficial para manejo de archivos High-Capacity." 
    href="https://www.7-zip.org/" 
  />
</CardGrid>

:::tip[Tip de Integridad]
Confirmar siempre el tama√±o final con:  
`Get-ChildItem "$dest\*.zip" | Select-Object Name, @{N="GB"; E={$_.Length / 1GB}}`
:::

---
**Generado por:** dzamo-sysadmin | **Estado:** Sintaxis Verificada en PS7
