---
title: "Restauraci√≥n y Despliegue de Instancias WSL 2"
description: "Protocolo de reconstrucci√≥n de entornos Linux a partir de artefactos .tar tras una migraci√≥n de sistema o fallo de hardware."
sidebar:
  label: "WSL 2: Restauraci√≥n (Import)"
  badge:
    text: "DR"
    variant: success
---

import { Steps, Aside, LinkCard, CardGrid, Badge } from '@astrojs/starlight/components';

Una vez realizada la migraci√≥n del sistema operativo o ante la necesidad de replicar un entorno, se procede a reconstruir las instancias Linux utilizando los artefactos `.tar`. Este proceso garantiza que el entorno de desarrollo sea id√©ntico al original.

<Badge text="Escenario: Recuperaci√≥n ante Desastres" variant="success" /> <Badge text="Herramienta: WSL CLI" variant="note" />

---

## üîÑ Flujo de Restauraci√≥n

El proceso no termina con la importaci√≥n; requiere ajustes de identidad y optimizaci√≥n de disco para ser plenamente operativo.

```mermaid
graph TD
    Zip[Extraer Pack .zip] --> Tar[Obtener Archivo .tar]
    Tar --> Import[wsl --import]
    Import --> User[Configurar Usuario Default]
    User --> Sparse[Habilitar VHD Sparse]
    Sparse --> Ready[Entorno Funcional]
```

---

## üõ†Ô∏è Procedimiento de Despliegue

Siga estos pasos desde una terminal de **PowerShell 7** con permisos de escritura en el disco de destino.

<Steps>

1.  **Despliegue de la Distribuci√≥n**
    
    Importamos el sistema de archivos especificando el nombre de la instancia y la ruta de instalaci√≥n (donde se crear√° el nuevo `ext4.vhdx`).

    ```powershell
    # Definir ruta de instancias (Tier Caliente)
    $installRoot = "D:\10_Hot-Tier_Caliente\WSL\instances"

    # Importar instancia de Ubuntu
    wsl --import Ubuntu "$installRoot\Ubuntu" ".\Ubuntu.tar" --version 2

    # Importar instancia de Rocky Linux 9
    wsl --import RockyLinux9 "$installRoot\RockyLinux9" ".\RockyLinux9.tar" --version 2
    ```

2.  **Restablecer Usuario Predeterminado**
    
    <Aside type="caution" title="Comportamiento por Defecto">
    Tras un `--import`, WSL inicia siempre como usuario `root`. Para volver a tu usuario operativo (`dzamo`), utiliza el archivo de configuraci√≥n interna.
    </Aside>

    Entre en la distribuci√≥n y cree el archivo de configuraci√≥n:
    ```bash
    # Ejecutar dentro de la instancia Linux
    sudo tee /etc/wsl.conf <<EOF
    [user]
    default=dzamo
    EOF
    ```
    *Nota: Requiere reiniciar la instancia (`wsl --terminate <distro>`) para aplicar cambios.*

3.  **Optimizaci√≥n de Almacenamiento (Sparse VHD)**
    
    Para evitar que el disco virtual reserve espacio innecesario en el host, habilitamos el modo *sparse*.

    ```powershell
    wsl --manage Ubuntu --set-sparse true
    wsl --manage RockyLinux9 --set-sparse true
    ```

</Steps>

---

## üîç Verificaci√≥n e Integridad

Una vez completados los pasos, valide que el inventario de WSL refleja los estados correctos:

```powershell
wsl --list --verbose
```

| Par√°metro | Valor Esperado |
| :--- | :--- |
| **Versi√≥n** | 2 |
| **Estado** | Stopped / Running |
| **Usuario** | No-root (tras configurar wsl.conf) |

---

## üîó Art√≠culos de la Serie

<CardGrid>
  <LinkCard 
    title="SOP: Exportaci√≥n Base" 
    description="C√≥mo capturar el RootFS antes de la migraci√≥n." 
    href="/es/notes/wsl-export-guide/" 
  />
  <LinkCard 
    title="SOP: Backup >2GB" 
    description="Estrategias de compresi√≥n con 7-Zip para archivos pesados." 
    href="/es/notes/wsl-migration-backup-strategy/" 
  />
</CardGrid>

---

**Generado por:** dzamo-sysadmin | **Status:** Operativo post-migraci√≥n
