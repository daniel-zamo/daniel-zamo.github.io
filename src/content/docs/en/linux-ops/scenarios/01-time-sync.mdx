---
title: "NTP Strategy & Time Synchronization"
description: Configuration of systemd-timesyncd policies for transactional consistency in distributed clusters.
sidebar:
  label: NTP Strategy
  order: 1
type: scenario
domain: networking
source: manual
---

import { Steps } from '@astrojs/starlight/components';
import LabEnvironment from '../../../../../components/LabEnvironment.astro';

<LabEnvironment />

## ðŸ“‹ Scenario Requirements

**Context:** Drift in system clocks is causing failures in distributed transaction logs. You must enforce a strict NTP policy on the `terminal` controller.

**Configuration Standard:**
1.  **Primary Upstreams:** `0.pool.ntp.org`, `1.pool.ntp.org`.
2.  **Performance Tuning:**
    *   Max poll interval: `1000s`.
    *   Retry interval: `20s`.

:::caution[Service Context]
This scenario uses `systemd-timesyncd`, which is the default lightweight SNTP client on Ubuntu. Do not install `chrony` or `ntp` packages unless explicitly asked, as they conflict with timesyncd.
:::

---

## ðŸ”§ Solution Walkthrough

<Steps>

1.  **Audit current status**

    Before applying changes, verify the operating system version and the current time synchronization status.

    ```bash
    # Check OS version
    cat /etc/os-release | grep PRETTY_NAME
    # Output: PRETTY_NAME="Ubuntu 24.04.3 LTS"

    # Check active time service
    dpkg -l | grep systemd-timesync
    ```

    You can query the current status of the daemon using `timedatectl`:

    ```bash
    timedatectl timesync-status
    ```

2.  **Modify configuration**

    Open the configuration file `/etc/systemd/timesyncd.conf`.

    ```bash
    sudo vim /etc/systemd/timesyncd.conf
    ```

    Modify the `[Time]` section to match the requirements. Uncomment the lines if necessary.

    ```ini title="/etc/systemd/timesyncd.conf" {2-5}
    [Time]
    NTP=0.pool.ntp.org 1.pool.ntp.org
    FallbackNTP=ntp.ubuntu.com 0.debian.pool.ntp.org
    PollIntervalMaxSec=1000
    ConnectionRetrySec=20
    ```

    :::tip[Man Pages]
    If you are unsure about a specific directive syntax during the exam, use:
    `man timesyncd.conf`
    :::

3.  **Restart the service**

    Apply the changes by restarting the systemd unit.

    ```bash
    sudo systemctl restart systemd-timesyncd.service
    ```

4.  **Verify implementation**

    Ensure the service is active and running without errors.

    ```bash
    sudo systemctl status systemd-timesyncd.service
    ```

    *Expected output snippet:*
    ```text
    Status: "Contacted time server 82.165.173.235:123 (0.pool.ntp.org)."
    Active: active (running) ...
    ```

    Finally, validate the operational metrics (Poll interval and Jitter) using `timedatectl`.

    ```bash
    timedatectl timesync-status
    ```

    ```text {2}
    Server: 82.165.173.235 (0.pool.ntp.org)
    Poll interval: 1min 4s (min: 32s; max 16min 40s)
    ...
    ```

</Steps>

## ðŸ” Troubleshooting

If the synchronization fails, check the system logs for specific daemon messages:

```bash
sudo grep systemd-timesyncd /var/log/syslog
# Or use journalctl
sudo journalctl -u systemd-timesyncd
```

Successful synchronization logs will look like this:
> *Contacted time server ... (0.pool.ntp.org).*
> *Initial clock synchronization to ...*
