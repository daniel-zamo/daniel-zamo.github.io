---
title: "NTP Strategy & Time Synchronization"
description: Configuration of systemd-timesyncd policies for transactional consistency in distributed clusters.
sidebar:
  label: NTP Strategy
  order: 1
type: scenario
domain: networking
source: manual
---

import { Steps } from '@astrojs/starlight/components';
import LabEnvironment from '../../../../../components/LabEnvironment.astro';

<LabEnvironment />

## üìã Engineering Requirements

**Business Context:**
Audit logs indicate drift in system clocks across the cluster, causing failures in distributed transaction reconciliation. A strict NTP policy must be enforced on the controller node to ensure consistency.

**Technical Objectives:**
1.  **Primary Upstreams:** Configure `0.pool.ntp.org` and `1.pool.ntp.org` as authoritative sources.
2.  **Failover:** Define `ntp.ubuntu.com` and `0.debian.pool.ntp.org` as fallback servers.
3.  **Performance Tuning:**
    *   Max poll interval: `1000s`.
    *   Connection retry interval: `20s`.

:::caution[Service Constraint]
The environment utilizes `systemd-timesyncd` as the standard lightweight SNTP client. Do not install `chrony` or legacy `ntp` packages unless explicitly required, to avoid service conflicts.
:::

---

## üîß Implementation Procedure

<Steps>

1.  **Audit Current State**

    Verify the operating system version and the active time synchronization status before applying changes.

    ```bash
    # Check OS version
    cat /etc/os-release | grep PRETTY_NAME

    # Verify active time service status
    timedatectl timesync-status
    ```

2.  **Apply Configuration Policy**

    Edit the daemon configuration file `/etc/systemd/timesyncd.conf`.

    ```bash
    sudo vim /etc/systemd/timesyncd.conf
    ```

    Modify the `[Time]` section to strictly match the engineering requirements:

    ```ini title="/etc/systemd/timesyncd.conf" {2-5}
    [Time]
    NTP=0.pool.ntp.org 1.pool.ntp.org
    FallbackNTP=ntp.ubuntu.com 0.debian.pool.ntp.org
    PollIntervalMaxSec=1000
    ConnectionRetrySec=20
    ```

3.  **Restart Service**

    Apply the new policy by restarting the systemd unit.

    ```bash
    sudo systemctl restart systemd-timesyncd.service
    ```

4.  **Validate Implementation**

    Confirm the service is active and synchronizing with the correct upstream stratum.

    ```bash
    # Check service status
    sudo systemctl status systemd-timesyncd.service

    # Validate metrics (Poll interval)
    timedatectl timesync-status
    ```

    *Validation Criteria:* Output must show `Active: active (running)` and `Poll interval` metrics matching the configuration.

</Steps>

## üîç Troubleshooting

If synchronization fails (e.g., "Packet not received"), inspect the system journal:

```bash
sudo journalctl -u systemd-timesyncd --no-pager | tail -n 20
```

*Success Indicator:* Look for logs stating: *"Contacted time server ... (0.pool.ntp.org)"*.
