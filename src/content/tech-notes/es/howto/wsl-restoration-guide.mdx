---
title: "Restauraci√≥n y Despliegue de Instancias WSL 2"
description: "Protocolo de reconstrucci√≥n de entornos Linux a partir de artefactos .tar tras una migraci√≥n de sistema o fallo de hardware."
date: 2026-01-30
category: "howto"
systems: ["windows", "linux"]
difficulty: "beginner"
tags: ["wsl2", "disaster-recovery", "sysadmin", "migration"]
author: "Daniel Zamo"
lang: "es"
sidebar:
  label: "WSL 2: Restore"
  badge:
    text: "DR"
    variant: success
---

import { Steps, Aside, Badge, LinkCard, CardGrid } from '@astrojs/starlight/components';

Este protocolo describe la reconstrucci√≥n de instancias Linux utilizando artefactos `.tar`. Es el paso cr√≠tico tras una migraci√≥n de host o una recuperaci√≥n ante desastres (DR).

<Badge text="Escenario: Recuperaci√≥n / Migraci√≥n" variant="success" /> <Badge text="Host: Windows 10/11" variant="note" />

---

## üîÑ Flujo de Reconstrucci√≥n Operativa

El despliegue no es solo una importaci√≥n de datos; requiere la rehidrataci√≥n del sistema de archivos y la reconfiguraci√≥n de la identidad del usuario para ser plenamente operativo.

```mermaid
graph TD
    A[Artefacto .tar] --> B{wsl --import}
    B --> C[Asignaci√≥n de VHDX]
    C --> D[Configuraci√≥n Identity]
    D --> E[Optimizaci√≥n Sparse]
    E --> F[Entorno Funcional]

    style B fill:#2c3e50,color:#fff
    style F fill:#27ae60,color:#fff
```

---

## üõ†Ô∏è Procedimiento de Despliegue

Siga estos pasos desde una terminal de **PowerShell 7** con permisos de escritura en la unidad de destino.

<Steps>

1.  **Importaci√≥n de la Distribuci√≥n**
    
    Definimos el nombre de la instancia, el directorio de residencia del VHDX y el archivo fuente.

    ```powershell
    # Definir ruta de instancias (Storage Tier)
    $installRoot = "D:\WSL\instances"

    # Importar instancia (Ejemplo: Ubuntu)
    wsl --import Ubuntu "$installRoot\Ubuntu" ".\Ubuntu.tar" --version 2
    ```

2.  **Restablecimiento de Usuario Predeterminado**
    
    <Aside type="caution" title="Comportamiento Post-Import">
    Por dise√±o, WSL inicia como `root` tras una importaci√≥n. Para volver a su usuario operativo (ej. `dzamo`), debe declarar la identidad.
    </Aside>

    Entre en la instancia y genere el archivo de configuraci√≥n:
    ```bash
    # Ejecutar dentro de Linux
    sudo tee /etc/wsl.conf <<EOF
    [user]
    default=dzamo
    EOF
    ```
    *Nota: Ejecute `wsl --terminate <distro>` en PowerShell para aplicar los cambios.*

3.  **Habilitar Almacenamiento Din√°mico (Sparse)**
    
    Para evitar que el archivo `.vhdx` reserve espacio innecesario en el host, habilitamos el modo *sparse*.

    ```powershell
    wsl --manage Ubuntu --set-sparse true
    ```

</Steps>

---

## üîç Verificaci√≥n e Integridad

Valide que el inventario de WSL refleja los estados correctos y el uso de la arquitectura Versi√≥n 2:

```powershell
wsl --list --verbose
```

| Par√°metro | Valor Esperado |
| :--- | :--- |
| **Versi√≥n** | 2 |
| **Estado** | Stopped / Running |
| **Usuario** | No-root (validado v√≠a `whoami`) |

---

## üîó Art√≠culos de la Serie

<CardGrid>
  <LinkCard 
    title="SOP: Exportaci√≥n Base" 
    description="C√≥mo capturar el RootFS antes de la migraci√≥n." 
    href="/es/tech-notes/howto/wsl-export-guide/" 
  />
  <LinkCard 
    title="Documentaci√≥n Microsoft" 
    description="Comandos de importaci√≥n de WSL." 
    href="https://learn.microsoft.com/en-us/windows/wsl/basic-commands#import-a-distribution" 
  />
</CardGrid>

**Autor:** `dzamo-sysadmin` | **Status:** Operativo post-migraci√≥n
