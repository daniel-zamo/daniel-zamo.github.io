---
// RUTA: src/components/QuizLoader.astro (VERSIÓN FINAL)
import { getCollection } from 'astro:content';
import Quiz from './Quiz.astro';

// 1. En el servidor, obtenemos TODAS las preguntas.
const allQuestions = await getCollection('questions');
---

<!-- 2. Renderizamos TODOS los quizzes, pero ocultos por defecto.
     Cada quiz está dentro de un div con su ID único. -->
<div id="quiz-container-wrapper">
  {allQuestions.map(question => (
    <div id={question.id} class="quiz-instance" style="display: none;">
      <Quiz question={question.data} />
    </div>
  ))}

  <!-- También renderizamos un mensaje de error, oculto por defecto -->
  <div id="quiz-not-found" style="display: none;">
    <h3>Question not found</h3>
    <p>The requested question ID was not found in our database.</p>
    <p>Please return to the <a href="/practice/">practice index</a>.</p>
  </div>
</div>

<!-- 3. Este script se ejecutará EN EL NAVEGADOR del usuario -->
<script>
  // Obtenemos los parámetros de la URL actual del navegador
  const params = new URLSearchParams(window.location.search);
  const questionId = params.get('id');

  if (questionId) {
    // Buscamos el div del quiz que tiene el ID correspondiente
    const quizElement = document.getElementById(questionId);

    if (quizElement) {
      // Si lo encontramos, lo mostramos
      quizElement.style.display = 'block';
    } else {
      // Si el ID está en la URL pero no encontramos el div, mostramos el error
      document.getElementById('quiz-not-found').style.display = 'block';
    }
  } else {
    // Si no hay ningún ID en la URL, también mostramos el error
    document.getElementById('quiz-not-found').style.display = 'block';
  }
</script>
